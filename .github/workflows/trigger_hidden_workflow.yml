name: Trigger Hidden Workflow

on:
  push:
    branches: [ main ] # 当 main 分支有新的 push 时触发
  pull_request:
    branches: [ main ] # 当向 main 分支发起 pull request 时触发
  workflow_dispatch: # 允许手动触发此工作流
    inputs:
      ref: # 传递给私有工作流的分支或标签
        description: 'Branch or tag to use for the hidden workflow'
        required: true
        default: '${{ github.ref }}'
      sha: # 传递给私有工作流的 commit SHA
        description: 'Commit SHA to use for the hidden workflow'
        required: true
        default: '${{ github.sha }}'

jobs:
  trigger:
    runs-on: ubuntu-latest
    steps:
      - name: Generate GitHub App Token
        id: generate_token
        uses: actions/create-github-app-token@v1
        with:
          app-id: ${{ secrets.APP_ID }}
          private-key: ${{ secrets.PRIVATE_KEY }}

      - name: Trigger private workflow via repository_dispatch
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ steps.generate_token.outputs.token }} # 使用 GitHub App 生成的 token
          repository: Plan2241/my-hidden-workflows # 您的私有仓库
          event: run_hidden_workflow # 自定义事件名称，私有工作流将监听此事件
          client-payload: '{"ref": "${{ github.event.inputs.ref || github.ref }}", "sha": "${{ github.event.inputs.sha || github.sha }}", "public_repo": "${{ github.repository }}"}'name: Trigger Hidden Workflow

on:
  push:
    branches: [ main ] # 当 main 分支有新的 push 时触发
  pull_request:
    branches: [ main ] # 当向 main 分支发起 pull request 时触发
  workflow_dispatch: # 允许手动触发此工作流
    inputs:
      ref: # 传递给私有工作流的分支或标签
        description: 'Branch or tag to use for the hidden workflow'
        required: true
        default: '${{ github.ref }}'
      sha: # 传递给私有工作流的 commit SHA
        description: 'Commit SHA to use for the hidden workflow'
        required: true
        default: '${{ github.sha }}'

jobs:
  trigger:
    runs-on: ubuntu-latest
    steps:
      - name: Generate GitHub App Token
        id: generate_token
        uses: actions/create-github-app-token@v1
        with:
          app-id: ${{ secrets.APP_ID }}
          private-key: ${{ secrets.PRIVATE_KEY }}

      - name: Trigger private workflow via repository_dispatch
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ steps.generate_token.outputs.token }} # 使用 GitHub App 生成的 token
          repository: Plan2241/my-hidden-workflows # 您的私有仓库
          event: run_hidden_workflow # 自定义事件名称，私有工作流将监听此事件
          client-payload: '{"ref": "${{ github.event.inputs.ref || github.ref }}", "sha": "${{ github.event.inputs.sha || github.sha }}", "public_repo": "${{ github.repository }}"}'
